wkhomeControllers.controller("listPublications",["$translate","$routeParams","$scope","globalData","sparqlQuery","searchData","$window",function(t,r,a,o,i,e,n){function u(t){var r=angular.lowercase(t);return function(t){return angular.lowercase(t.tag).indexOf(r)!==-1}}t.use(r.lang);var c=e.publicationsSearch;a.todos=[];var s=[];a.autores=[];var d=[];if(c){var l=c["@graph"],f=l,b=(f.length?f:[f],_.where(l,{"@type":"bibo:Document"})),h=_.where(l,{"@type":"foaf:Person"}),p={};_.map(b,function(t){p.id=t["@id"];var r=t["dct:title"];r.constructor===Array||r instanceof Array||Array.isArray(r)?p.title=r[0]:p.title=t["dct:title"];var a=t["dct:contributor"];void 0!==a&&(a.constructor===Array||a instanceof Array||Array.isArray(a))?p.author=a[0]:p.author=t["dct:contributor"],p["abstract"]=t["bibo:abstract"]?t["bibo:abstract"]:"Sorry, still not found abstract for this publication.",p.uri=t["bibo:uri"]&&t["bibo:uri"]["@id"]?t["bibo:uri"]["@id"]:"",d=[];var o=0;_.map(t["dct:contributors"],function(t){o+=1;var r=t["@id"]?_.findWhere(h,{"@id":t["@id"]}):_.findWhere(h,{"@id":t});d.push({id:r["@id"],name:r["foaf:name"][1]?r["foaf:name"][1]:r["foaf:name"]})}),p.title&&s.push({id:p.id,title:p.title,"abstract":p["abstract"],uri:p.uri,author:d})}),a.filteredTodos=[],a.currentPage=1,a.numPerPage=10,a.maxSize=5,a.$watch("currentPage + numPerPage",function(){var t=(a.currentPage-1)*a.numPerPage,r=t+a.numPerPage;a.filteredTodos=s.slice(t,r)})}a.todos=s,a.autores=d,a.querySearch=function(t){return t?e.allkeywordsList.filter(u(t)):e.allkeywordsList},a.clickonAuthor=function(t){clickonRelatedauthor(t)},clickonRelatedauthor=function(t){var u=o.PREFIX+" CONSTRUCT {   <"+t+"> foaf:name ?name; a foaf:Person   }    WHERE  {Graph <"+o.centralGraph+">{     <"+t+"> a foaf:Person.     <"+t+"> foaf:name ?name } }";i.querySrv({query:u},function(i){jsonld.compact(i,o.CONTEXT,function(o,i){a.$apply(function(){e.authorSearch=i,n.location.hash="/"+r.lang+"/w/search?"+t})})})},a.todos=[],a.ctrlFn=function(t){var r=_.where(t,{"@type":"bibo:Document"}),o=_.where(t,{"@type":"foaf:Person"});a.todos=[],a.autores=[];var i={};_.map(r,function(t){i.id=t["@id"],i.title=t["dct:title"],i.author=t["dct:contributor"]?t["dct:contributor"]:[],i["abstract"]=t["bibo:abstract"]?t["bibo:abstract"]:"Sorry, still not found abstract for this publication.",i.uri=t["bibo:uri"]&&t["bibo:uri"]["@id"]?t["bibo:uri"]["@id"]:"",a.autores=[];var r=0;_.map(t["dct:contributors"],function(t){r+=1;var i=t["@id"]?_.findWhere(o,{"@id":t["@id"]}):_.findWhere(o,{"@id":t});a.autores.push({id:i["@id"],name:i["foaf:name"]})}),i.title&&a.todos.push({id:i.id,title:i.title,"abstract":i["abstract"],uri:i.uri,author:a.autores})}),a.loadData()},a.exportReport=function(t){a.keyw=t,a.showRepButtons=!0}}]);