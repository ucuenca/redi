wkhomeControllers.controller("pubInfoController",["$routeParams","$scope","$window","sparqlQuery","searchData","globalData",function(t,a,e,u,r,o){a.todos=[],a.loadData=function(){a.filteredTodos=[],a.currentPage=1,a.numPerPage=10,a.maxSize=5,a.$watch("currentPage + numPerPage",function(){var t=(a.currentPage-1)*a.numPerPage,e=t+a.numPerPage;a.filteredTodos=a.todos.slice(t,e)})};var c=r.genericData;a.todos=[];var n={};_.map(c,function(t){n.id=t["@id"],n.title=t["dct:title"],n["abstract"]=t["bibo:abstract"]?t["bibo:abstract"]:"",n.uri=t["bibo:uri"]["@id"],n.keywords=t["bibo:Quote"],n.title&&a.todos.push({id:n.id,title:n.title,"abstract":n["abstract"],uri:n.uri,keywords:n.keywords})}),a.loadData(),a.$watch("searchData.genericData",function(t,e,u){a.data={schema:{context:o.CONTEXT,fields:["rdfs:label","uc:total"]},data:r.genericData}}),a.searchAuthor=function(t){var e=o.PREFIX+" CONSTRUCT {   ?subject foaf:name ?name; a foaf:Person   }   WHERE {     Graph <"+o.centralGraph+">     {         ?subject a foaf:Person.         ?subject foaf:name ?name.         ?subject foaf:publications <"+t.id+">.     }} limit 1";u.querySrv({query:e},function(t){jsonld.compact(t,o.CONTEXT,function(t,e){a.$apply(function(){a.loadRelatedAuthors(e)})})})},a.loadRelatedAuthors=function(t){function a(t,a){var e=t;u.querySrv({query:e},function(t){jsonld.compact(t,o.CONTEXT,function(t,e){if(e){var u=e["@graph"];if(u){var r=$("div.tree-node-author-info ."+a);r.html("");var o=u.length?u:[u],c=$("<div>");r.append(c),_.map(o,function(t){var a=(JSON.stringify(t),$("<a class='relatedauthors' target='blank' onclick = 'return clickonRelatedauthor(\""+t["@id"]+"\")'  >").text(""));return a.append('<img src="/wkhome/images/author-ec.png" class="img-rounded" alt="Logo Cedia" width="20" height="20"        >'),a.append(t["rdfs:label"]),c.append(a),c.append("</br>"),a})}}})})}function e(t){var e=t["@id"];if(t["foaf:name"]){var u=String.format(r,t["foaf:name"],e);a(u,"authorsByClusters");var u=String.format(c,t["foaf:name"],e);a(u,"authorsByPublications")}}var r=o.PREFIX+' CONSTRUCT {  <http://ucuenca.edu.ec/wkhuska/resultTitle> a uc:pagetitle. <http://ucuenca.edu.ec/wkhuska/resultTitle> uc:viewtitle "Authors Related With {0}"  .         ?subject rdfs:label ?name.         ?subject uc:total ?totalPub   }   WHERE {   {  SELECT DISTINCT  ?subject ?name (count(?pub) as ?totalPub) WHERE {    GRAPH <'+o.clustersGraph+">          {  ?cluster <http://ucuenca.edu.ec/resource/hasPerson> <{1}> . ?cluster <http://ucuenca.edu.ec/resource/hasPerson> ?subject.           ?subject foaf:publications ?pub          { SELECT ?name {      graph <"+o.centralGraph+">            {        \t?subject foaf:name ?name.            } }  }              }      } group by ?subject ?name           }}    ",c=o.PREFIX+'  CONSTRUCT {  <http://ucuenca.edu.ec/wkhuska/resultTitle> a uc:pagetitle. <http://ucuenca.edu.ec/wkhuska/resultTitle> uc:viewtitle "Authors Related With {0}" .         ?subject rdfs:label ?name.         ?subject uc:total ?totalPub   }   WHERE {   {      SELECT ?subject (count(?pub) as ?totalPub) ?name          WHERE {              GRAPH <'+o.centralGraph+"> {              <{1}> foaf:publications ?pub.              ?subject foaf:publications ?pub.             ?subject foaf:name ?name.  }              }          GROUP BY ?subject ?name   }  }";e(t["@graph"][0])},a.todos[0]&&a.searchAuthor(a.todos[0])}]);