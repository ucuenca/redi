wkhomeControllers.controller("publicationsController",["$scope","$window","globalData","sparqlQuery","searchData","$routeParams","$translate",function(i,a,t,e,n,o,r){r.use(o.lang),i.publications=[],i.author={};var c=o.authorId,u=t.PREFIX+" CONSTRUCT { <"+c+"> uc:publication ?publicationUri.   <"+c+"> uc:publication ?publicationUri.  ?publicationUri a bibo:AcademicArticle;                    dct:title ?title;                    bibo:abstract ?abstract;                    bibo:uri ?uri;} WHERE {  GRAPH  <"+t.centralGraph+"> {    <"+c+"> foaf:publications ?publicationUri .    ?publicationUri dct:title ?title .    OPTIONAL { ?publicationUri bibo:abstract  ?abstract.  }      OPTIONAL { ?publicationUri bibo:uri  ?uri.  }   }}",l=t.PREFIX+"CONSTRUCT {  <"+c+"> a foaf:Person ;                    foaf:name ?name ;                    foaf:topic ?area ;                    dct:provenance ?provenance;                    foaf:img ?img.  ?provenance uc:city ?city .  ?provenance uc:province ?province .  ?provenance uc:fullName ?fullname .} WHERE{  {  \tSELECT *    WHERE {       GRAPH <"+t.centralGraph+"> {        <"+c+"> a foaf:Person ;                           foaf:name ?name ;                           dct:provenance ?provenance ;        OPTIONAL { <"+c+"> foaf:topic_interest ?topicURI. }        OPTIONAL { <"+c+"> foaf:img ?img. }        OPTIONAL { ?topicURI rdfs:label ?area. }        {          SELECT ?city ?province ?fullname {            GRAPH <"+t.endpointsGraph+"> {              ?provenance uc:city ?city .              ?provenance uc:province ?province .              ?provenance uc:fullName ?fullname .            }          }        }      }    }    LIMIT 10  }}";waitingDialog.show("Searching: "),e.querySrv({query:u},function(a){jsonld.compact(a,t.CONTEXT,function(a,t){if(t){var e=_.where(t["@graph"],{"@type":"bibo:AcademicArticle"}),n=e.length?e:[e],o={};_.map(n,function(a){o.id=a["@id"],o.title="string"!=typeof a["dct:title"]?_.first(a["dct:title"]):a["dct:title"],o["abstract"]="string"!=typeof a["bibo:abstract"]?_.first(a["bibo:abstract"]):a["bibo:abstract"],o.uri=classifyURLS(a["bibo:uri"]),o.title&&i.publications.push({id:o.id,title:o.title,"abstract":o["abstract"],uri:o.uri})}),i.loadData(),waitingDialog.hide()}else waitingDialog.hide()})}),e.querySrv({query:l},function(a){jsonld.compact(a,t.CONTEXT,function(a,t){if(!a){var e=_.findWhere(t["@graph"],{"@type":"foaf:Person"});i.author.name="string"==typeof e["foaf:name"]?e["foaf:name"]:_.first(e["foaf:name"]),i.author.areas=e["foaf:topic"],i.author.photo=e["foaf:img"]?e["foaf:img"]["@id"]:void 0,i.author.institutions=[],_.each(e["dct:provenance"],function(a){var e="object"==typeof a?_.findWhere(t["@graph"],a):_.findWhere(t["@graph"],{"@id":a}),n=location.href.indexOf("/es/")!==-1?_.findWhere(e["uc:fullName"],{"@language":"es"})["@value"]:_.findWhere(e["uc:fullName"],{"@language":"en"})["@value"];i.author.institutions.push({name:n,province:e["uc:city"],city:e["uc:province"]})})}})}),classifyURLS=function(i){var a={uri:"",type:""};return"[object Array]"===Object.prototype.toString.call(i)?_.each(i,function(i){return a.uri=i["@id"],i["@id"].indexOf(".pdf")!==-1?(a.type="pdf",a):void(a.type="web")}):"object"==typeof i&&(a.uri=i["@id"],a.type=i["@id"].indexOf(".pdf")!==-1?"pdf":"web"),a},i.loadData=function(){i.$apply(function(){i.filterPublications=[],i.currentPage=1,i.numPerPage=10,i.maxSize=5,i.$watch("currentPage + numPerPage",function(){var a=(i.currentPage-1)*i.numPerPage,t=a+i.numPerPage;i.filterPublications=i.publications.slice(a,t)})})},i.loadAuthorProfile=function(){a.location.hash="/"+o.lang+"/w/search?"+c}}]);